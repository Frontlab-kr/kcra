



<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>통합시스템</title>
	

	<!-- Global stylesheets -->
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700,900">
	<link rel="stylesheet" type="text/css" href="http://dev2.onesnc.co.kr/static/global_assets/css/icons/icomoon/styles.css">
	<link rel="stylesheet" type="text/css" href="http://dev2.onesnc.co.kr/static/global_assets/css/icons/fontawesome/styles.min.css">
	<link rel="stylesheet" type="text/css" href="http://dev2.onesnc.co.kr/static/global_assets/css/bootstrap.css">
	<link rel="stylesheet" type="text/css" href="http://dev2.onesnc.co.kr/static/global_assets/css/core.css">
	<link rel="stylesheet" type="text/css" href="http://dev2.onesnc.co.kr/static/global_assets/css/components.css">
	<link rel="stylesheet" type="text/css" href="http://dev2.onesnc.co.kr/static/global_assets/css/colors.min.css">
	<!-- /global stylesheets -->

	<!-- Core JS files -->
	<script src="http://dev2.onesnc.co.kr/static/global_assets/js/plugins/loaders/pace.min.js"></script>
	<script src="http://dev2.onesnc.co.kr/static/global_assets/js/core/libraries/jquery.min.js"></script>
	<script src="http://dev2.onesnc.co.kr/static/global_assets/js/core/libraries/bootstrap.min.js"></script>
	<script src="http://dev2.onesnc.co.kr/static/global_assets/js/plugins/loaders/blockui.min.js"></script>
	<script src="http://dev2.onesnc.co.kr/static/global_assets/js/app.js"></script>
	<!-- /core JS files -->

	<script src="http://dev2.onesnc.co.kr/static/global_assets/js/plugins/ui/moment/moment.min.js"></script>
	<script src="http://dev2.onesnc.co.kr/static/global_assets/js/plugins/ui/moment/moment_locales.min.js"></script>

	<script src="http://dev2.onesnc.co.kr/static/global_assets/js/plugins/editors/summernote/summernote.min.js"></script>
	<script src="http://dev2.onesnc.co.kr/static/global_assets/js/plugins/forms/styling/uniform.min.js"></script>
	<script src="http://dev2.onesnc.co.kr/static/global_assets/js/plugins/editors/summernote/lang/summernote-ko-KR.js"></script>

	<script src="http://dev2.onesnc.co.kr/static/global_assets/js/plugins/forms/selects/select2.min.js"></script>
	<script src="http://dev2.onesnc.co.kr/static/global_assets/js/plugins/jquery-form/jquery.form.js"></script>

	<!-- datepicker -->
	<script src="http://dev2.onesnc.co.kr/static/global_assets/js/core/libraries/jquery_ui/core.min.js"></script>
	<script src="http://dev2.onesnc.co.kr/static/global_assets/js/core/libraries/jquery_ui/interactions.min.js"></script>
	<script src="http://dev2.onesnc.co.kr/static/global_assets/js/core/libraries/jquery_ui/widgets.min.js"></script>
	<script src="http://dev2.onesnc.co.kr/static/global_assets/js/core/libraries/jquery_ui/effects.min.js"></script>
	<!-- /datepicker -->

	<script src="https://cdn.jsdelivr.net/lodash/4.17.4/lodash.min.js"></script>

	<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
	<script src="http://dev2.onesnc.co.kr/static/common_js.js"></script>
	<!-- /theme JS files -->
	<!-- sheetjs  -->
	<script type="text/javascript" src="//cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
</head>

<body>

	<!-- Main navbar -->
	<div class="navbar navbar-inverse header-highlight"><!-- navbar-default 제거 -->
		<div class="navbar-header">
			<a class="navbar-brand" href="/">한국휴게음식업중앙회</a>

			<ul class="nav navbar-nav visible-xs-block">
				<li><a data-toggle="collapse" data-target="#navbar-mobile"><i class="icon-tree5"></i></a></li>
				<li><a class="sidebar-mobile-main-toggle"><i class="icon-paragraph-justify3"></i></a></li>
			</ul>
		</div>

		<div class="navbar-collapse collapse" id="navbar-mobile">
			<ul class="nav navbar-nav">
				<li><a class="sidebar-control sidebar-main-toggle hidden-xs"><i class="icon-paragraph-justify3"></i></a></li>
			</ul>

			<ul class="nav navbar-nav navbar-right">
			<!-- 	<li><a href="#">Text link</a></li>

				<li>
					<a href="#">
						<i class="icon-cog3"></i>
						<span class="visible-xs-inline-block position-right">Icon link</span>
					</a>
				</li> -->

				<li class="dropdown dropdown-user">
					<a class="dropdown-toggle" data-toggle="dropdown">
						<img src="http://dev2.onesnc.co.kr/static/global_assets/images/image.png" alt="">
						<span>관리자</span>
						<i class="caret"></i>
					</a>

					<ul class="dropdown-menu dropdown-menu-right">
						<li><a href="/logout"><i class="icon-switch2"></i> Logout</a></li>
					</ul>
				</li>
			</ul>
		</div>
	</div>
	<!-- /main navbar -->
<script>
var LOGIN_USER_ID = 'admin';
var LOGIN_USER_TYPE = 'MASTER_ADMIN';
$.datepicker.setDefaults({
    dateFormat: 'yymmdd',
    prevText: '이전 달',
    nextText: '다음 달',
    monthNames: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
    monthNamesShort: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
    dayNames: ['일', '월', '화', '수', '목', '금', '토'],
    dayNamesShort: ['일', '월', '화', '수', '목', '금', '토'],
    dayNamesMin: ['일', '월', '화', '수', '목', '금', '토'],
    showMonthAfterYear: true,
    yearSuffix: '년'
});
</script>


	<!-- Page container -->
	<div class="page-container">

		<!-- Page content -->
		<div class="page-content">

			<!-- Main sidebar -->
			<div class="sidebar sidebar-main sidebar-default">
				<div class="sidebar-content">
					<!-- Main navigation -->
					<div class="sidebar-category sidebar-category-visible">
						<div class="category-content no-padding">
							<ul class="navigation navigation-main navigation-accordion" id="site_menu"></ul>
						</div>
					</div>
					<!-- /main navigation -->

				</div>
			</div>
			<!-- /main sidebar -->

			<script>
				commonAjaxFunc("/site/menu",{"menuType":"MENU_"+LOGIN_USER_TYPE },"GET",function(data){
					if(data!=null){
						$("#site_menu").empty();
						for(var i=0;i<data.length;i++){
							var vo = data[i];
							var menuCd = vo.menuCd;
							var moduleCd = vo.moduleCd;
							var menuName = vo.menuName;
							var moduleUri = vo.moduleUri;
							var menuDepthType = vo.menuDepthType;
							if(menuDepthType == "U"){
								if(menuCd == 'MENU_00015'){
									$("#site_menu").append("<li  data-id='"+menuCd+"' class='active'><a href='"+moduleUri+"'><i class='"+vo.iconClass+"'></i><span>"+menuName+"</span></a></li>");
								}else{
									$("#site_menu").append("<li  data-id='"+menuCd+"'><a href='"+moduleUri+"'><i class='"+vo.iconClass+"'></i><span>"+menuName+"</span></a></li>");
								}

							}else if(menuDepthType == "M"){
								if(menuCd == 'MENU_00015' || moduleUri == '/admin/statistics/period'){
									if($("#site_menu > li").last().find("ul").length == 0 ){$("#site_menu li").last().append("<ul><li data-id='"+menuCd+"' class='active'><a href='"+moduleUri+"'><i class=''></i><span>"+menuName+"</span></a></li></ul>");}
									else{
										$("#site_menu > li").last().find("ul").append("<li data-id='"+menuCd+"' class='active'><a href='"+moduleUri+"'><i class=''></i><span>"+menuName+"</span></a></li>");
									}

								}else{
									if($("#site_menu > li").last().find("ul").length == 0 ){$("#site_menu li").last().append("<ul><li data-id='"+menuCd+"'><a href='"+moduleUri+"'><i class=''></i><span>"+menuName+"</span></a></li></ul>");}
									else{
										$("#site_menu > li").last().find("ul").append("<li data-id='"+menuCd+"'><a href='"+moduleUri+"'><i class=''></i><span>"+menuName+"</span></a></li>");
									}

								}

							}
						}
						//$("#site_menu li[data-id = 'MENU_00015']").addClass("active");
						mainNavigationSetting();
					}
				});

				$(document).on("click","#site_menu li > a", function(e){
					if($(this).parent().attr("data-id") != undefined){
						moveMenu($(this).parent().attr("data-id") );
					}
				});
			</script>

<div class="content-wrapper">
	<div class="content">
		<!-- list table s  -->
		<input type="hidden" name="currentPageNo" value="1"/>
		<div class="row">
			<div class="panel panel-flat">
				<div class="panel-heading">
					<h5 class="panel-title">기간대비통계</h5>
				</div>
				<div class="panel-body ">
					<div class="table-responsive">
						<form name="searchForm" id="searchForm" method="post">
							<input type="hidden" class="form-control " name="searchStartDate" placeholder="">
							<input type="hidden" class="form-control " name="searchEndDate" placeholder="">
				            <table class="table search-table">
				              <tbody>
				              	<tr>
				                	<th>구분</th>
				                  	<td>
					                    <select name="searchCcTarget" id="searchCcTarget" class="form-control">
					                      <option value=""  selected="selected">구분</option>
					                      <option value="기존영업자">기존영업자</option>
					                      <option value="신규영업자">신규영업자</option>
					                      <option value="자판기영업자">자판기영업자</option>
					                    </select>
				                  	</td>
				                  	<th>조회조건</th>
				                  	<td>
				                  		<select name="" class="form-control">
				                  			<option value="monthly" selected>월대비</option>
				                  		</select>
			                  		</td>
			                	</tr>
				                <tr>
				                  <th>조회일자</th>
				                  <td>
				                  	<div class="form-inline">
										<select name="searchStartYear" id="searchStartYear" class="form-control">
											<option value="">년도</option>
										</select>
										<select name="searchStartMonth" id="searchStartMonth" class="form-control">
											<option value="">월</option>
										</select>
									</div>
									</td>
									<th>조회일자2</th>
									<td>
										<div class="form-inline">
											<select name="searchEndYear" id="searchEndYear" class="form-control">
												<option value="">년도</option>
											</select>
											<select name="searchEndMonth" id="searchEndMonth" class="form-control">
												<option value="">월</option>
											</select>
										</div>

									</div>
				                  </td>
				                </tr>
				              </tbody>
				            </table>
			            </form>
			            <div class="text-center mt-10">
			              <button type="button" class="btn btn-xs btn-search" onclick="statistics.init();">검색</button>
			            </div>
			        </div>
					<div class="d-flex flex-row-reverse">
						<button type="button" class="btn btn-xs btn-info mr-5" onclick="statistics.excelDown();">다운로드</button>
					</div>
					<div class="table-responsive">
						<table class="table result-table" id="dataTable">
							<thead>
								<tr>
									<th class="text-center" style="background-color:#ddd;">비교일자</th>
									<th class="text-center" style="background-color:#ddd;">수료일자1</th>
									<th class="text-center" style="background-color:#ddd;">수료일자2</th>
									<th class="text-center" style="background-color:#ddd;">증감율(%)</th>
								</tr>
							</thead>
							<tbody></tbody>
						</table>
					</div>
				</div>
				<div class="text-center content-group-lg pt-20" id="pagination"></div>
			</div>
		</div>
		<!-- list table e  -->
	
		<!-- Footer -->
			<div class="footer text-muted">
				© 2021 ONESNC-Software & Creative
			</div>
		<!-- /footer -->
		</div>

	</div>
</div>
</div>
</body>
</html>
<script>
$(document).ready(function(){
	commonAjaxFunc("/common/code/list",{"commonCode":"CMM_MONTH"},"GET",function(data){
		$("#searchStartMonth, #searchEndMonth").empty();
		$("#searchStartMonth, #searchEndMonth").append("<option value=''>월</option>");
		for(var i=0;i<data.length;i++){
			$("#searchStartMonth,#searchEndMonth").append("<option value='"+data[i].codeValue+"'>"+data[i].codeName+"</option>");
		}
	})
	commonAjaxFunc("/common/code/list",{"commonCode":"STATIC_YEAR"},"GET",function(data){
		$("#searchStartYear, #searchEndYear").empty();
		$("#searchStartYear, #searchEndYear").append("<option value=''>년도</option>");
		for(var i=0;i<data.length;i++){
			$("#searchStartYear, #searchEndYear").append("<option value='"+data[i].codeValue+"'>"+data[i].codeName+"</option>");
		}
	})
})
	var statistics = (function(){

		var init = function(){

			if(isEmpty($("#searchStartYear").val())||isEmpty($("#searchStartMonth").val())
				||isEmpty($("#searchEndYear").val())||isEmpty($("#searchEndMonth").val()) ){
				alert("조회일자를 설정해주세요.");
				return false;
			}

			var searchStartDate = $("#searchStartYear").val()+$("#searchStartMonth").val();
			var searchEndDate = $("#searchEndYear").val()+$("#searchEndMonth").val();
			commonAjaxFunc("/statistics/period/list",{
				"searchCcTarget": $("#searchCcTarget").val()
				, "searchStartDate":searchStartDate
				, "searchEndDate" : searchEndDate
			},"GET",function(data){
				if(data != null){
					var list = data.list;
					var htmlStr = "";
					var t_result = _(data.list).groupBy('searchDate').map((searchDate,id) => ({searchDate:id, cnt:_.sumBy(searchDate,'cnt')})).value();

					if(list == null || list.length == 0){
					}else{
						var first_value = _.get(_.find(t_result,['searchDate',searchStartDate]),'cnt');
						var sec_value = _.get(_.find(t_result,['searchDate',searchEndDate]),'cnt');

						htmlStr +='<tr>';
						htmlStr +='	<td class="text-center">'+moment(searchStartDate,"YYYYMM").format("YYYY-MM")+'/'+moment(searchEndDate,"YYYYMM").format("YYYY-MM")+'</td>';
						htmlStr +='	<td class="text-center">'+first_value+'</td>';
						htmlStr +='	<td class="text-center">'+sec_value+'</td>';
						htmlStr +='	<td class="text-center">'+calChangeRate(first_value,sec_value)+'	</td>';
						htmlStr +='</tr>';



					}
					$("#dataTable tbody").html(htmlStr);
				}

			});

		}
		var calChangeRate = function(num1, num2){
			if(num1 == 0){
				return "-"
			}else{
				var result = (num2-num1)/num1*100
				result = result.toFixed(2);
				return result;
			}
		}
		var excelDown = function(type, fn){
			var elt = document.getElementById('dataTable');
			var wb = XLSX.utils.table_to_book(elt, {sheet:"통계", raw:true});
			var date = moment().format('YYYYMMDD');
			XLSX.writeFile(wb, fn || ('period_statistics_'+date+'.' + (type || 'xlsx')));
		}
		return { init:init, excelDown:excelDown}
	})();
</script>



