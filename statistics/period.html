<!DOCTYPE html>
<html lang="ko">
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>통합시스템</title>

		<!-- Global stylesheets -->
		<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700,900" />
		<link rel="stylesheet" type="text/css" href="http://dev2.onesnc.co.kr/static/global_assets/css/icons/icomoon/styles.css" />
		<link rel="stylesheet" type="text/css" href="http://dev2.onesnc.co.kr/static/global_assets/css/icons/fontawesome/styles.min.css" />
		<link rel="stylesheet" type="text/css" href="http://dev2.onesnc.co.kr/static/global_assets/css/bootstrap.css" />
		<link rel="stylesheet" type="text/css" href="http://dev2.onesnc.co.kr/static/global_assets/css/core.css" />
		<link rel="stylesheet" type="text/css" href="http://dev2.onesnc.co.kr/static/global_assets/css/components.css" />
		<link rel="stylesheet" type="text/css" href="http://dev2.onesnc.co.kr/static/global_assets/css/colors.min.css" />
		<!-- /global stylesheets -->

		<!-- Core JS files -->
		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/plugins/loaders/pace.min.js"></script>
		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/core/libraries/jquery.min.js"></script>
		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/core/libraries/bootstrap.min.js"></script>
		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/plugins/loaders/blockui.min.js"></script>
		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/app.js"></script>
		<!-- /core JS files -->

		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/plugins/ui/moment/moment.min.js"></script>
		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/plugins/ui/moment/moment_locales.min.js"></script>

		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/plugins/editors/summernote/summernote.min.js"></script>
		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/plugins/forms/styling/uniform.min.js"></script>
		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/plugins/editors/summernote/lang/summernote-ko-KR.js"></script>

		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/plugins/forms/selects/select2.min.js"></script>
		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/plugins/jquery-form/jquery.form.js"></script>

		<!-- datepicker -->
		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/core/libraries/jquery_ui/core.min.js"></script>
		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/core/libraries/jquery_ui/interactions.min.js"></script>
		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/core/libraries/jquery_ui/widgets.min.js"></script>
		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/core/libraries/jquery_ui/effects.min.js"></script>
		<!-- /datepicker -->

		<script src="https://cdn.jsdelivr.net/lodash/4.17.4/lodash.min.js"></script>

		<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
		<script src="http://dev2.onesnc.co.kr/static/common_js.js"></script>
		<!-- /theme JS files -->
		<!-- sheetjs  -->
		<script type="text/javascript" src="//cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

		<!-- frontlab -->
		<link rel="stylesheet" type="text/css" href="/assets/css/common.css" />
		<script
			src="https://cdnjs.cloudflare.com/ajax/libs/colresizable/1.6.0/colResizable-1.6.js"
			integrity="sha512-0HfjrMq6p8VBkVjp/gy/obELN81BCwmKRd7fongBsAPw49BeKAfXpQn6PWSPa8rm7mvblqyV2P1kVNzvW6qR4Q=="
			crossorigin="anonymous"
			referrerpolicy="no-referrer"
		></script>
		<script>
			$(document).ready(function () {
				$('.kcra-list .table').colResizable({
					liveDrag: true,
					gripInnerHtml: "<div class='grip'></div>",
					draggingClass: 'dragging',
					resizeMode: 'fit',
				});
				$('.kcra-sidebar-list__item a').on('click', function () {
					$(this).parents('.kcra-sidebar-list__item').toggleClass('active');
					return false;
				});
			});
		</script>
	</head>

	<body>
		<div class="kcra">
			<div class="kcra-sidebar">
				<div class="kcra-sidebar-logo">
					<a href=""><img src="/assets/images/logo.png" alt="KCRA 한국휴게음식업중앙회교육원" /></a>
				</div>
				<div class="kcra-sidebar-user">
					<div class="dropdown">
						<button id="dLabel" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							<img src="../assets/images/user.png" alt="" />
							관리자
							<span class="material-symbols-outlined"> expand_more </span>
						</button>
						<ul class="dropdown-menu">
							<li>
								<a href="/logout">로그아웃</a>
							</li>
						</ul>
					</div>
				</div>
				<div class="kcra-sidebar-list">
					<div class="kcra-sidebar-list__item">
						<a href=""><span class="material-symbols-outlined"> settings </span><strong>설정</strong></a>
					</div>
					<div class="kcra-sidebar-list__item">
						<a href=""><span class="material-symbols-outlined"> corporate_fare </span><strong>업소정보관리</strong></a>
					</div>
					<div class="kcra-sidebar-list__item">
						<a href=""><span class="material-symbols-outlined"> school </span><strong>교육결과조회</strong></a>
					</div>
					<div class="kcra-sidebar-list__item depth">
						<a href=""><span class="material-symbols-outlined"> stress_management </span><strong>집합교육관리조회</strong></a>
						<ul>
							<li class="active">
								<a href="/admin/offline/manage"><span>신규영업자</span></a>
							</li>
						</ul>
					</div>
					<div class="kcra-sidebar-list__item">
						<a href=""><span class="material-symbols-outlined"> contract_edit </span><strong>통보서관리</strong></a>
					</div>
					<div class="kcra-sidebar-list__item">
						<a href=""><span class="material-symbols-outlined"> data_table </span><strong>이관데이터관리</strong></a>
					</div>
					<div class="kcra-sidebar-list__item">
						<a href=""><span class="material-symbols-outlined"> analytics </span><strong>수료현황</strong></a>
					</div>
					<div class="kcra-sidebar-list__item">
						<a href=""><span class="material-symbols-outlined"> assignment_ind </span><strong>수료자등록</strong></a>
					</div>
					<div class="kcra-sidebar-list__item active depth">
						<a href=""><span class="material-symbols-outlined"> bar_chart_4_bars </span><strong>통계</strong></a>
						<ul>
							<li class="active">
								<a href="/admin/statistics/company"><span>영업대장별 통계</span></a>
							</li>
							<li>
								<a href="/admin/statistics/edu"><span>교육통계</span></a>
							</li>
							<li>
								<a href="/admin/statistics/period"><span>기간대비통계</span></a>
							</li>
							<li>
								<a href="/admin/statistics/age"><span>연령별통계</span></a>
							</li>
						</ul>
					</div>
					<div class="kcra-sidebar-list__item">
						<a href=""> <span class="material-symbols-outlined"> settings_cinematic_blur </span><strong>계정관리</strong></a>
					</div>
				</div>
			</div>
			<div class="kcra-contents kcra-list-form">
				<div class="kcra-title">
					<h1>기간대비통계</h1>
				</div>
				<div class="kcra-form">
					<div class="kcra-form__box">
						<form name="searchForm" id="searchForm" method="post">
							<input type="hidden" class="form-control" name="searchStartDate" placeholder="" />
							<input type="hidden" class="form-control" name="searchEndDate" placeholder="" />
							<table>
								<colgroup>
									<col style="width: 10%" />
									<col style="width: 40%" />
									<col style="width: 10%" />
									<col style="width: 40%" />
								</colgroup>
								<tbody>
									<tr>
										<th>구분</th>
										<td>
											<select name="searchCcTarget" id="searchCcTarget" class="form-control">
												<option value="" selected="selected">구분</option>
												<option value="기존영업자">기존영업자</option>
												<option value="신규영업자">신규영업자</option>
												<option value="자판기영업자">자판기영업자</option>
											</select>
										</td>
										<th>조회조건</th>
										<td>
											<select name="" class="form-control">
												<option value="monthly" selected>월대비</option>
											</select>
										</td>
									</tr>
									<tr>
										<th>조회일자</th>
										<td>
											<div class="kcra-datepicker" style="width: 250px">
												<select name="searchStartYear" id="searchStartYear" class="form-control mr-10">
													<option value="">년도</option>
												</select>
												<select name="searchStartMonth" id="searchStartMonth" class="form-control">
													<option value="">월</option>
												</select>
											</div>
										</td>
										<th>조회일자2</th>
										<td>
											<div class="kcra-datepicker" style="width: 250px">
												<select name="searchEndYear" id="searchEndYear" class="form-control mr-10">
													<option value="">년도</option>
												</select>
												<select name="searchEndMonth" id="searchEndMonth" class="form-control">
													<option value="">월</option>
												</select>
											</div>
										</td>
									</tr>
								</tbody>
							</table>
						</form>
					</div>
					<div class="kcra-form__button">
						<button type="button" class="btn" onclick="statistics.init();"><span class="material-symbols-outlined"> search </span>검색</button>
					</div>
				</div>
				<div class="kcra-list">
					<div class="kcra-list-head">
						<div class="kcra-list-head__total">조회건수 : <strong>43</strong>건</div>
						<div class="kcra-list-head__button">
							<button type="button" class="btn btn-sm btn-gray" onclick="statistics.excelDown();">
								<span class="material-symbols-outlined"> download </span>다운로드
							</button>
						</div>
					</div>
					<div class="table-responsive">
						<table class="table result-table" id="dataTable">
							<thead>
								<tr>
									<th class="text-center" style="background-color: #ddd">비교일자</th>
									<th class="text-center" style="background-color: #ddd">수료일자1</th>
									<th class="text-center" style="background-color: #ddd">수료일자2</th>
									<th class="text-center" style="background-color: #ddd">증감율(%)</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td class="text-center">2023-01/2023-12</td>
									<td class="text-center">1914</td>
									<td class="text-center">0</td>
									<td class="text-center">-100.00</td>
								</tr>
							</tbody>
						</table>
					</div>
					<div class="kcra-pagination">
						<ul class="pagination">
							<li><a href="javascript:goPage(1);">이전</a></li>
							<li class="active"><a href="#">1</a></li>
							<li><a href="javascript:goPage('2');">2</a></li>
							<li><a href="javascript:goPage('3');">3</a></li>
							<li><a href="javascript:goPage('4');">4</a></li>
							<li><a href="javascript:goPage('5');">5</a></li>
							<li><a href="javascript:goPage('6');">6</a></li>
							<li><a href="javascript:goPage('7');">7</a></li>
							<li><a href="javascript:goPage('8');">8</a></li>
							<li><a href="javascript:goPage('9');">9</a></li>
							<li><a href="javascript:goPage('10');">10</a></li>
							<li><a href="javascript:goPage(11);">다음</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>
<script>
	$(document).ready(function () {
		commonAjaxFunc('/common/code/list', { commonCode: 'CMM_MONTH' }, 'GET', function (data) {
			$('#searchStartMonth, #searchEndMonth').empty();
			$('#searchStartMonth, #searchEndMonth').append("<option value=''>월</option>");
			for (var i = 0; i < data.length; i++) {
				$('#searchStartMonth,#searchEndMonth').append("<option value='" + data[i].codeValue + "'>" + data[i].codeName + '</option>');
			}
		});
		commonAjaxFunc('/common/code/list', { commonCode: 'STATIC_YEAR' }, 'GET', function (data) {
			$('#searchStartYear, #searchEndYear').empty();
			$('#searchStartYear, #searchEndYear').append("<option value=''>년도</option>");
			for (var i = 0; i < data.length; i++) {
				$('#searchStartYear, #searchEndYear').append("<option value='" + data[i].codeValue + "'>" + data[i].codeName + '</option>');
			}
		});
	});
	var statistics = (function () {
		var init = function () {
			if (
				isEmpty($('#searchStartYear').val()) ||
				isEmpty($('#searchStartMonth').val()) ||
				isEmpty($('#searchEndYear').val()) ||
				isEmpty($('#searchEndMonth').val())
			) {
				alert('조회일자를 설정해주세요.');
				return false;
			}

			var searchStartDate = $('#searchStartYear').val() + $('#searchStartMonth').val();
			var searchEndDate = $('#searchEndYear').val() + $('#searchEndMonth').val();
			commonAjaxFunc(
				'/statistics/period/list',
				{
					searchCcTarget: $('#searchCcTarget').val(),
					searchStartDate: searchStartDate,
					searchEndDate: searchEndDate,
				},
				'GET',
				function (data) {
					if (data != null) {
						var list = data.list;
						var htmlStr = '';
						var t_result = _(data.list)
							.groupBy('searchDate')
							.map((searchDate, id) => ({ searchDate: id, cnt: _.sumBy(searchDate, 'cnt') }))
							.value();

						if (list == null || list.length == 0) {
						} else {
							var first_value = _.get(_.find(t_result, ['searchDate', searchStartDate]), 'cnt');
							var sec_value = _.get(_.find(t_result, ['searchDate', searchEndDate]), 'cnt');

							htmlStr += '<tr>';
							htmlStr +=
								'	<td class="text-center">' +
								moment(searchStartDate, 'YYYYMM').format('YYYY-MM') +
								'/' +
								moment(searchEndDate, 'YYYYMM').format('YYYY-MM') +
								'</td>';
							htmlStr += '	<td class="text-center">' + first_value + '</td>';
							htmlStr += '	<td class="text-center">' + sec_value + '</td>';
							htmlStr += '	<td class="text-center">' + calChangeRate(first_value, sec_value) + '	</td>';
							htmlStr += '</tr>';
						}
						$('#dataTable tbody').html(htmlStr);
					}
				}
			);
		};
		var calChangeRate = function (num1, num2) {
			if (num1 == 0) {
				return '-';
			} else {
				var result = ((num2 - num1) / num1) * 100;
				result = result.toFixed(2);
				return result;
			}
		};
		var excelDown = function (type, fn) {
			var elt = document.getElementById('dataTable');
			var wb = XLSX.utils.table_to_book(elt, { sheet: '통계', raw: true });
			var date = moment().format('YYYYMMDD');
			XLSX.writeFile(wb, fn || 'period_statistics_' + date + '.' + (type || 'xlsx'));
		};
		return { init: init, excelDown: excelDown };
	})();
</script>
