<!DOCTYPE html>
<html lang="ko">
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>통합시스템</title>

		<!-- Global stylesheets -->
		<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700,900" />
		<link rel="stylesheet" type="text/css" href="http://dev2.onesnc.co.kr/static/global_assets/css/icons/icomoon/styles.css" />
		<link rel="stylesheet" type="text/css" href="http://dev2.onesnc.co.kr/static/global_assets/css/icons/fontawesome/styles.min.css" />
		<link rel="stylesheet" type="text/css" href="http://dev2.onesnc.co.kr/static/global_assets/css/bootstrap.css" />
		<link rel="stylesheet" type="text/css" href="http://dev2.onesnc.co.kr/static/global_assets/css/core.css" />
		<link rel="stylesheet" type="text/css" href="http://dev2.onesnc.co.kr/static/global_assets/css/components.css" />
		<link rel="stylesheet" type="text/css" href="http://dev2.onesnc.co.kr/static/global_assets/css/colors.min.css" />
		<!-- /global stylesheets -->

		<!-- Core JS files -->
		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/plugins/loaders/pace.min.js"></script>
		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/core/libraries/jquery.min.js"></script>
		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/core/libraries/bootstrap.min.js"></script>
		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/plugins/loaders/blockui.min.js"></script>
		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/app.js"></script>
		<!-- /core JS files -->

		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/plugins/ui/moment/moment.min.js"></script>
		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/plugins/ui/moment/moment_locales.min.js"></script>

		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/plugins/editors/summernote/summernote.min.js"></script>
		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/plugins/forms/styling/uniform.min.js"></script>
		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/plugins/editors/summernote/lang/summernote-ko-KR.js"></script>

		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/plugins/forms/selects/select2.min.js"></script>
		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/plugins/jquery-form/jquery.form.js"></script>

		<!-- datepicker -->
		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/core/libraries/jquery_ui/core.min.js"></script>
		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/core/libraries/jquery_ui/interactions.min.js"></script>
		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/core/libraries/jquery_ui/widgets.min.js"></script>
		<script src="http://dev2.onesnc.co.kr/static/global_assets/js/core/libraries/jquery_ui/effects.min.js"></script>
		<!-- /datepicker -->

		<script src="https://cdn.jsdelivr.net/lodash/4.17.4/lodash.min.js"></script>

		<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
		<script src="http://dev2.onesnc.co.kr/static/common_js.js"></script>
		<!-- /theme JS files -->
		<!-- sheetjs  -->
		<script type="text/javascript" src="//cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

		<!-- frontlab -->
		<link rel="stylesheet" type="text/css" href="/assets/css/common.css" />
		<script
			src="https://cdnjs.cloudflare.com/ajax/libs/colresizable/1.6.0/colResizable-1.6.js"
			integrity="sha512-0HfjrMq6p8VBkVjp/gy/obELN81BCwmKRd7fongBsAPw49BeKAfXpQn6PWSPa8rm7mvblqyV2P1kVNzvW6qR4Q=="
			crossorigin="anonymous"
			referrerpolicy="no-referrer"
		></script>
		<script>
			$(document).ready(function () {
				$('.kcra-list .table').colResizable({
					liveDrag: true,
					gripInnerHtml: "<div class='grip'></div>",
					draggingClass: 'dragging',
					resizeMode: 'fit',
				});
				$('.kcra-sidebar-list__item a').on('click', function () {
					$(this).parents('.kcra-sidebar-list__item').toggleClass('active');
					return false;
				});
			});
		</script>
	</head>

	<body>
		<div class="kcra">
			<div class="kcra-sidebar">
				<div class="kcra-sidebar-logo">
					<a href=""><img src="/assets/images/logo.png" alt="KCRA 한국휴게음식업중앙회교육원" /></a>
				</div>
				<div class="kcra-sidebar-user">
					<div class="dropdown">
						<button id="dLabel" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							<img src="../assets/images/user.png" alt="" />
							관리자
							<span class="material-symbols-outlined"> expand_more </span>
						</button>
						<ul class="dropdown-menu">
							<li>
								<a href="/logout">로그아웃</a>
							</li>
						</ul>
					</div>
				</div>
				<div class="kcra-sidebar-list">
					<div class="kcra-sidebar-list__item">
						<a href=""><span class="material-symbols-outlined"> settings </span><strong>설정</strong></a>
					</div>
					<div class="kcra-sidebar-list__item">
						<a href=""><span class="material-symbols-outlined"> corporate_fare </span><strong>업소정보관리</strong></a>
					</div>
					<div class="kcra-sidebar-list__item">
						<a href=""><span class="material-symbols-outlined"> school </span><strong>교육결과조회</strong></a>
					</div>
					<div class="kcra-sidebar-list__item depth">
						<a href=""><span class="material-symbols-outlined"> stress_management </span><strong>집합교육관리조회</strong></a>
						<ul>
							<li class="active">
								<a href="/admin/offline/manage"><span>신규영업자</span></a>
							</li>
						</ul>
					</div>
					<div class="kcra-sidebar-list__item">
						<a href=""><span class="material-symbols-outlined"> contract_edit </span><strong>통보서관리</strong></a>
					</div>
					<div class="kcra-sidebar-list__item">
						<a href=""><span class="material-symbols-outlined"> data_table </span><strong>이관데이터관리</strong></a>
					</div>
					<div class="kcra-sidebar-list__item">
						<a href=""><span class="material-symbols-outlined"> analytics </span><strong>수료현황</strong></a>
					</div>
					<div class="kcra-sidebar-list__item">
						<a href=""><span class="material-symbols-outlined"> assignment_ind </span><strong>수료자등록</strong></a>
					</div>
					<div class="kcra-sidebar-list__item active depth">
						<a href=""><span class="material-symbols-outlined"> bar_chart_4_bars </span><strong>통계</strong></a>
						<ul>
							<li class="active">
								<a href="/admin/statistics/company"><span>영업대장별 통계</span></a>
							</li>
							<li>
								<a href="/admin/statistics/edu"><span>교육통계</span></a>
							</li>
							<li>
								<a href="/admin/statistics/period"><span>기간대비통계</span></a>
							</li>
							<li>
								<a href="/admin/statistics/age"><span>연령별통계</span></a>
							</li>
						</ul>
					</div>
					<div class="kcra-sidebar-list__item">
						<a href=""> <span class="material-symbols-outlined"> settings_cinematic_blur </span><strong>계정관리</strong></a>
					</div>
				</div>
			</div>
			<div class="kcra-contents kcra-list-form">
				<div class="kcra-title">
					<h1>연령대별 통계</h1>
				</div>
				<div class="kcra-form">
					<div class="kcra-form__box">
						<table>
							<tbody>
								<tr>
									<th>구분</th>
									<td>
										<select name="searchCcTarget" id="searchCcTarget" class="form-control">
											<option value="" selected="selected">구분</option>
											<option value="기존영업자">기존영업자</option>
											<option value="신규영업자">신규영업자</option>
											<option value="자판기영업자">자판기영업자</option>
										</select>
									</td>
								</tr>
								<tr>
									<th>수료일자</th>
									<td>
										<div class="kcra-datepicker">
											<div class="kcra-datepicker__input">
												<input type="text" class="form-control datepicker" name="searchStartDate" placeholder="" />
												<span class="material-symbols-outlined"> calendar_month </span>
											</div>
											<span>~</span>
											<div class="kcra-datepicker__input">
												<input type="text" class="form-control datepicker" name="searchEndDate" placeholder="" />
												<span class="material-symbols-outlined"> calendar_month </span>
											</div>
										</div>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
					<div class="kcra-form__button">
						<button type="button" class="btn" onclick="statistics.init();"><span class="material-symbols-outlined"> search </span>검색</button>
					</div>
				</div>
				<div class="kcra-list">
					<div class="kcra-list-head">
						<div class="kcra-list-head__total">조회건수 : <strong>43</strong>건</div>
						<div class="kcra-list-head__button">
							<button type="button" class="btn btn-sm btn-gray" nclick="statistics.excelDown('xlsx');">
								<span class="material-symbols-outlined"> download </span>다운로드
							</button>
						</div>
					</div>
					<div class="table-responsive">
						<table class="table result-table" id="dataTable">
							<thead>
								<tr>
									<th class="text-center">연령대</th>
									<th class="text-center">수료건수</th>
									<th class="text-center">비율</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td class="text-center">10대</td>
									<td class="text-center">44</td>
									<td class="text-center">0.02%</td>
								</tr>
								<tr>
									<td class="text-center">20대</td>
									<td class="text-center">23186</td>
									<td class="text-center">10.72%</td>
								</tr>
								<tr>
									<td class="text-center">30대</td>
									<td class="text-center">55124</td>
									<td class="text-center">25.48%</td>
								</tr>
								<tr>
									<td class="text-center">40대</td>
									<td class="text-center">57932</td>
									<td class="text-center">26.78%</td>
								</tr>
								<tr>
									<td class="text-center">50대</td>
									<td class="text-center">53503</td>
									<td class="text-center">24.73%</td>
								</tr>
								<tr>
									<td class="text-center">60대</td>
									<td class="text-center">23019</td>
									<td class="text-center">10.64%</td>
								</tr>
								<tr>
									<td class="text-center">70대</td>
									<td class="text-center">3503</td>
									<td class="text-center">1.62%</td>
								</tr>
								<tr>
									<td class="text-center">합계</td>
									<td class="text-center">216311</td>
									<td class="text-center">1.62%</td>
								</tr>
							</tbody>
						</table>
					</div>
					<div class="kcra-pagination">
						<ul class="pagination">
							<li><a href="javascript:goPage(1);">이전</a></li>
							<li class="active"><a href="#">1</a></li>
							<li><a href="javascript:goPage('2');">2</a></li>
							<li><a href="javascript:goPage('3');">3</a></li>
							<li><a href="javascript:goPage('4');">4</a></li>
							<li><a href="javascript:goPage('5');">5</a></li>
							<li><a href="javascript:goPage('6');">6</a></li>
							<li><a href="javascript:goPage('7');">7</a></li>
							<li><a href="javascript:goPage('8');">8</a></li>
							<li><a href="javascript:goPage('9');">9</a></li>
							<li><a href="javascript:goPage('10');">10</a></li>
							<li><a href="javascript:goPage(11);">다음</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>

<script>
	$('.datepicker').datepicker({ dateFormat: 'yy-mm-dd' });
	var statistics = (function () {
		var init = function () {
			commonLoadingAjaxFunc(
				'/statistics/age/list',
				{
					searchCcTarget: $('#searchCcTarget').val(),
					searchStartDate: $('input[name=searchStartDate]').val(),
					searchEndDate: $('input[name=searchEndDate]').val(),
				},
				'GET',
				function (data) {
					if (data != null) {
						var htmlStr = '';
						if (data.list == null || data.list.length == 0) {
						} else {
							var t_result = _(data.list)
								.groupBy('ageGroup')
								.map((ageGroup, id) => ({ ageGroup: id, cnt: _.sumBy(ageGroup, 'cnt') }))
								.value();
							var totalCnt = _.sumBy(t_result, 'cnt');
							for (var i = 0; i < t_result.length; i++) {
								var vo = t_result[i];
								var title = '';
								if (vo.ageGroup == '10age') {
									title = '10대';
								} else if (vo.ageGroup == '20age') {
									title = '20대';
								} else if (vo.ageGroup == '30age') {
									title = '30대';
								} else if (vo.ageGroup == '40age') {
									title = '40대';
								} else if (vo.ageGroup == '50age') {
									title = '50대';
								} else if (vo.ageGroup == '60age') {
									title = '60대';
								} else if (vo.ageGroup == '70age') {
									title = '70대';
								}

								htmlStr += '<tr>';

								htmlStr += "<td class='text-center'>" + title + '</td>';
								htmlStr += "<td class='text-center'>" + vo.cnt + '</td>';
								htmlStr += "<td class='text-center'>" + calculatePercentage(vo.cnt, totalCnt) + '%</td>';
								htmlStr += '</tr>';
							}
							htmlStr += '<tr>';

							htmlStr += "<td class='text-center'>합계</td>";
							htmlStr += "<td class='text-center'>" + totalCnt + '</td>';
							htmlStr += "<td class='text-center'>" + calculatePercentage(vo.cnt, totalCnt) + '%</td>';
							htmlStr += '</tr>';
						}
						$('#dataTable tbody').html(htmlStr);
					}
				}
			);
		};
		var excelDown = function (type, fn) {
			var elt = document.getElementById('dataTable');
			var wb = XLSX.utils.table_to_book(elt, { sheet: '통계', raw: true });
			var date = moment().format('YYYYMMDD');
			XLSX.writeFile(wb, fn || 'age_statistics_' + date + '.' + (type || 'xlsx'));
		};

		return { init: init, excelDown: excelDown };
	})();
	statistics.init();
</script>
